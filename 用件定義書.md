# SportsMatch Tokyo 用件定義書

## プロジェクト概要

---

## 第1章 はじめに

### 1.1 プロジェクト目的

本プロジェクト「SportsMatch Tokyo」（以下、本システムと称する）は、東京都内に居住する者、または東京を訪問する者が、気軽にスポーツ活動に参加できるプラットフォームを提供することを目的とする。本システムを通じて、同じスポーツに興味を持つ個人同士が容易に出会い、スポーツセッションに参加し、スポーツコミュニティを形成できる環境を整備する。

### 1.2 プロジェクト背景

スポーツ活動への参加意欲を持ちながらも、参加機会の確保やパートナーの発見が困難であるという課題が存在する。特に、新たな都市に移住した者、海外から来日した者、または既存のスポーツコミュニティから独立している者にとって、スポーツを通じた人間関係構築の機会は限定的である。本システムは、デジタルプラットフォームを活用して、このような機会の創造と仲介を行うことで、スポーツ参加の活性化とコミュニティ形成を実現する。

### 1.3 プロジェクト対象ユーザー

本システムのユーザーは、以下の3つのカテゴリに分類される。

1. **プレイヤー（通常ユーザー）**: スポーツセッションに参加することを望む個人
2. **オーガナイザー（セッション主催者）**: スポーツセッションを企画・運営する個人または団体
3. **管理者**: プラットフォーム全体の運営管理を担当する者

### 1.4 プロジェクト実施体制

本プロジェクトは、Next.js 16、TypeScript、PostgreSQL、Supabase、およびVercelを基盤とした、モダンなウェブアプリケーション開発フレームワークの上に構築される。フロントエンド、バックエンド、データベースの統合的なシステム設計により、スケーラビリティおよび保守性を確保する。

---

## 第2章 システム全体要件

### 2.1 システムアーキテクチャ

本システムのアーキテクチャは、マイクロサービスの思想に基づきながらも、単一統合プラットフォームとしての一体性を保つ。以下のレイヤーで構成される。

#### 2.1.1 プレゼンテーション層（フロントエンド）

Next.js 16のAppRouterを採用し、TypeScriptによる静的型付けを実施する。ユーザーインターフェースはTailwind CSS 4.1.17により実装され、35以上の再利用可能なUIコンポーネントで構成される。国際化対応（英語・日本語）をnext-intlにより実現し、ローカライズされたユーザー体験を提供する。

#### 2.1.2 業務アプリケーション層（API・ビジネスロジック）

Next.js APIRoutesを用いたRESTfulなAPI設計により、37個のエンドポイントが実装される。この層では、ユーザーの認証・認可、セッションの管理、チャット機能の提供、および各種データ操作のビジネスロジックが実行される。Prisma ClientによるType-Safeなデータベースアクセスにより、SQLインジェクションなどのセキュリティリスクを軽減する。

#### 2.1.3 永続化層（データベース）

PostgreSQLデータベースをSupabaseで管理し、11個のデータモデルと30以上のインデックスを持つスキーマにより、複雑なデータ関係を効率的に処理する。Prisma Migrationsを用いた段階的なスキーマ変更により、本番環境での安全なデータベース更新を実現する。

#### 2.1.4 インフラストラクチャ層

Vercelサーバーレスプラットフォームへの展開により、スケーラビリティと可用性を確保する。Supabaseの実時間機能（WebSocket）を活用し、チャットおよび通知の即時配信を実現する。Upstash RedisおよびUpstash Rate Limitにより、分散システムでのキャッシング およびレート制限を実装する。

### 2.2 機能要件の分類

本システムの機能要件は、以下のように分類される。

#### 2.2.1 ユーザー管理機能

ユーザーのライフサイクル全体を管理する機能群であり、登録、認証、プロフィール管理、および削除までの一連の処理を含む。

#### 2.2.2 セッション管理機能

スポーツセッションの企画、公開、検索、参加予約、および開催実績管理に関連する機能群である。

#### 2.2.3 コミュニケーション機能

セッション参加者間のリアルタイムチャット、システムからのプッシュ通知、およびメッセージング機能を含む。

#### 2.2.4 信頼・安全機能

ユーザーレビュー、信頼性スコア、不適切行為の報告、および管理者による調査と対応を含む。

#### 2.2.5 運営管理機能

管理者ダッシュボード、ユーザー管理、スポーツセンター管理、報告件数管理、およびプラットフォーム統計を含む。

### 2.3 非機能要件

#### 2.3.1 性能要件

- ページロード時間: 3秒以下
- API応答時間: 500ミリ秒以下
- 同時接続ユーザー数: 10,000ユーザーに対応可能
- データベースクエリ実行時間: 100ミリ秒以下（95パーセンタイル値）

#### 2.3.2 可用性要件

- 年間稼働率: 99.9%以上
- 計画的な保守作業: 月1回、所要時間30分以内
- 障害復旧時間（RTO）: 30分以内
- データ復旧目標時間（RPO）: 1時間以内

#### 2.3.3 セキュリティ要件

- 全データ通信のTLS 1.3以上での暗号化
- パスワードハッシング: Argon2による適切なハッシング
- 認証: JWT（JSON Web Token）をhttpOnlyクッキーに格納
- CSRF保護: トークンベースの検証
- SQLインジェクション対策: Prisma ORMの採用
- クロスサイトスクリプティング（XSS）対策: Content Security Policy（CSP）の実装
- ユーザー入力検証: Zodスキーマによる厳密な検証
- レート制限: 不正アクセスの防止

#### 2.3.4 信頼性要件

- バグ修正対応時間: 重大バグは24時間以内
- テストカバレッジ: 70%以上
- コード品質: ESLint、PrettierによるLinting実施

#### 2.3.5 スケーラビリティ要件

- ユーザー増加に対応可能な水平スケーリング
- データベースパフォーマンス維持: インデックス設計による最適化
- API呼び出しの増加に対応: サーバーレスアーキテクチャによる自動スケーリング

#### 2.3.6 保守性要件

- コードのモジュール化とコンポーネント化
- TypeScriptによる型安全性の確保
- APIドキュメント: OpenAPI/Swaggerフォーマット
- ログ記録: Pinoロガーにより全APIアクセスと例外を記録

---

## 第3章 ユーザー機能要件

### 3.1 ユーザー管理機能

#### 3.1.1 ユーザー登録（サインアップ）機能

**要件ID**: UM-001

**要件名**: ユーザー新規登録

**説明**: 新規ユーザーが本システムに登録するための機能である。ユーザーは、メールアドレスおよびパスワードを入力することで、アカウントを創成できる。

**実装詳細**:

- ユーザーが登録フォームに以下の情報を入力する:
  - メールアドレス（Eメール形式の検証）
  - パスワード（最低8文字、大文字・小文字・数字・記号を含む）
  - 表示名（ユーザー名、1～50文字）
  - プロフィール画像（オプション、JPEG/PNG形式、最大5MB）
  - ネイティブ言語（日本語、英語など）
  - 学習対象言語（オプション）

- 入力値検証:
  - Zodスキーマにより全フィールドの形式検証を実施
  - メールアドレスの一意性確認（既存登録の重複回避）
  - パスワードポリシーの実装（強度の確保）

- アカウント作成処理:
  - Supabase Authサービスによる認証情報の安全な保存
  - Prismaを用いてユーザーレコードをPostgreSQLに作成
  - デフォルト値の設定:
    - email_verified: false
    - is_banned: false
    - reliability_score: 1.0
    - no_show_count: 0

- メール認証フロー:
  - 登録完了直後に確認メールを送信（Resendサービス利用）
  - メール内のリンクをクリックすることで確認が完了
  - 未確認ユーザーは機能制限（セッション作成不可など）

**API**:
```
POST /api/auth/signup
Request Body:
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "displayName": "Taro Yamada",
  "nativeLanguage": "ja",
  "targetLanguage": "en"
}
Response:
{
  "id": "user-uuid",
  "email": "user@example.com",
  "displayName": "Taro Yamada",
  "emailVerified": false,
  "createdAt": "2024-01-15T10:30:00Z"
}
```

**UI要件**:
- サインアップページ（`/[locale]/(auth)/signup`）
- 段階的なフォーム（Step 1: メール・パスワード、Step 2: プロフィール情報）
- エラーメッセージの明確な表示
- ローディング状態の表示
- 成功後のメール確認画面への遷移

#### 3.1.2 ユーザーログイン機能

**要件ID**: UM-002

**要件名**: ユーザー認証・ログイン

**説明**: 既存ユーザーがメールアドレスとパスワードを用いてシステムにログインするための機能である。成功時には、認証トークンが発行され、以後のAPI呼び出しで使用される。

**実装詳細**:

- ログインフロー:
  - ユーザーが登録時のメールアドレスとパスワードを入力
  - Supabase Authによる認証（パスワードハッシュの検証）
  - 認証成功時にJWTトークンを発行

- トークン管理:
  - JWTをhttpOnlyクッキーに格納（XSS対策）
  - トークン有効期限: 7日間
  - リフレッシュトークン機構による自動更新

- セッション管理:
  - ログイン後、ユーザーの認証状態をReact ContextおよびAuthContextに保持
  - ナビゲーション自動リダイレクト（ログイン後はホームページへ）

- エラーハンドリング:
  - 不正なメールアドレス: "ユーザーが見つかりません"
  - 不正なパスワード: "パスワードが間違っています"
  - 複数失敗時のアカウントロック（5回失敗後、15分間ロック）

**API**:
```
POST /api/auth/login
Request Body:
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
Response:
{
  "id": "user-uuid",
  "email": "user@example.com",
  "displayName": "Taro Yamada",
  "token": "eyJhbGc...",
  "expiresIn": 604800
}
```

**UI要件**:
- ログインページ（`/[locale]/(auth)/login`）
- メールアドレスと パスワード入力欄
- "パスワード忘れ"リンク
- サインアップページへのリンク
- ローディング状態と エラーメッセージ表示

#### 3.1.3 ユーザープロフィール管理機能

**要件ID**: UM-003

**要件名**: ユーザープロフィール情報の表示・編集

**説明**: ユーザーが自身のプロフィール情報を閲覧・編集するための機能である。プロフィールには、基本情報、スポーツ関連情報、および言語情報が含まれる。

**基本情報**:
- 表示名（1～50文字）
- メールアドレス（変更不可、表示のみ）
- プロフィール画像（JPEG/PNG、最大5MB）
- 自己紹介（バイオ、最大300文字）
- 電話番号（オプション、検証済みマーク表示可）

**スポーツ関連情報**:
- スポーツ好みリスト（複数選択、最大10種類）
  - スポーツ例: バスケットボール、テニス、サッカー、ヨガ、ランニング等
- 各スポーツのスキルレベル（初心者、中級者、上級者）
- 言語レベル（Native, Advanced, Intermediate, Beginner）

**言語設定**:
- ネイティブ言語（日本語 / 英語 / その他）
- 学習対象言語（オプション）
- プラットフォーム表示言語（日本語 / 英語）

**プロフィール認証**:
- メール確認済みマーク（email_verified）
- 電話確認済みマーク（phone_verified）
- 学生認証マーク（is_verified_student、大学メール確認）
- 信頼度スコア（1.0～5.0、セッション参加・評価に基づき変動）

**実装詳細**:

- プロフィール表示エンドポイント:
  ```
  GET /api/users/me
  Response:
  {
    "id": "user-uuid",
    "email": "user@example.com",
    "displayName": "Taro Yamada",
    "bio": "Basketball enthusiast...",
    "avatarUrl": "https://...",
    "sportPreferences": ["basketball", "tennis"],
    "skillLevels": {
      "basketball": "INTERMEDIATE",
      "tennis": "BEGINNER"
    },
    "nativeLanguage": "ja",
    "targetLanguage": "en",
    "languageLevel": "INTERMEDIATE",
    "emailVerified": true,
    "phoneVerified": false,
    "isVerifiedStudent": false,
    "reliabilityScore": 4.2,
    "createdAt": "2024-01-15T10:30:00Z"
  }
  ```

- プロフィール編集エンドポイント:
  ```
  PATCH /api/users/me
  Request Body:
  {
    "displayName": "Taro Yamada",
    "bio": "新しい自己紹介...",
    "avatarUrl": "data:image/jpeg;base64,...",
    "sportPreferences": ["basketball", "tennis", "yoga"],
    "skillLevels": {
      "basketball": "ADVANCED",
      "tennis": "BEGINNER",
      "yoga": "INTERMEDIATE"
    }
  }
  Response: { success: true }
  ```

- プロフィール画像アップロード:
  - クライアント側での画像圧縮（最大幅1200px）
  - Base64エンコードでのサーバー送信
  - Supabase Storageへの保存（キャッシュヘッダ設定: 1年間のブラウザキャッシュ）

**UI要件**:
- プロフィール表示ページ（`/[locale]/profile`）
- プロフィール編集ページ（`/[locale]/profile/edit`）
- 複数のセクションタブ（基本情報、スポーツ、言語設定）
- 確認メールの再送信オプション
- 変更内容の保存確認ダイアログ
- ローディングと成功通知

#### 3.1.4 ユーザー統計表示機能

**要件ID**: UM-004

**要件名**: ユーザー活動統計の表示

**説明**: ユーザーが自身のスポーツ活動に関する統計情報を閲覧できる機能である。参加したセッション数、出席記録、評価などが含まれる。

**統計情報**:
- 参加したセッション数（累計）
- 作成したセッション数（累計）
- 出席したセッション数（実績）
- 欠席した回数（no_show_count）
- 受け取った評価の平均スコア（レビュー）
- 信頼度スコア（reliability_score）
- 参加していないスポーツ種別での参加率（目指すべき多様性）

**実装詳細**:

- 統計データ取得エンドポイント:
  ```
  GET /api/users/me/stats
  Response:
  {
    "sessionsJoined": 15,
    "sessionsCreated": 3,
    "sessionsAttended": 13,
    "noShowCount": 0,
    "averageRating": 4.5,
    "totalReviews": 8,
    "reliabilityScore": 4.7,
    "joinedByMonth": [
      { "month": "2024-01", "count": 3 },
      { "month": "2024-02", "count": 2 }
    ]
  }
  ```

- UI要件:
  - 統計表示ページ（プロフィール内の「統計」セクション）
  - グラフ表示（月別参加数、スポーツ別参加率）
  - 最近のセッション一覧（5件表示）

#### 3.1.5 ユーザーログアウト機能

**要件ID**: UM-005

**要件名**: ユーザーログアウト

**説明**: ユーザーが現在のセッションからログアウトし、認証を解除するための機能である。

**実装詳細**:

- ログアウトエンドポイント:
  ```
  POST /api/auth/logout
  Response: { success: true }
  ```

- ログアウト処理:
  - JWTトークンをクッキーから削除
  - React ContextのAuthStateをリセット
  - ローカルストレージの認証関連データをクリア
  - ログインページへのリダイレクト

**UI要件**:
- ナビゲーションバーのユーザーメニューにログアウト項目
- ログアウト前の確認ダイアログ
- 完了メッセージ表示

### 3.2 セッション閲覧・検索機能

#### 3.2.1 セッション一覧表示機能

**要件ID**: SS-001

**要件名**: スポーツセッション一覧の表示

**説明**: ホームページおよびセッション閲覧ページにおいて、今後開催されるスポーツセッションの一覧を表示する機能である。デフォルトでは、ユーザーの位置情報や興味に基づくセッションが優先的に表示される。

**表示内容**:

各セッションカード（SessionCard）には、以下の情報が表示される:

- セッション画像（スポーツのアイコンまたはセンター画像）
- スポーツ種別（バスケットボール、テニスなど）
- スキルレベル（初心者、中級者、上級者）
- 開催日時（YYYY-MM-DD HH:MM形式）
- 開催場所（スポーツセンター名、駅名）
- 所要時間（分単位）
- セッション雰囲気（Casual, Competitive, Academy, Language Exchange）
- 現在の参加者数 / 最大定員（「3/10」形式）
- 言語情報（プライマリ言語、英語対応フラグ）
- ユーザーの好感度ボタン（ハート/星）
- 主催者のプロフィール情報（表示名、信頼度スコア）

**実装詳細**:

- セッション一覧取得エンドポイント:
  ```
  GET /api/sessions?filters=...&sort=...&limit=...&offset=...
  Query Parameters:
  - sport: 対象スポーツ（複数選択可）
  - skillLevel: スキルレベル（BEGINNER, INTERMEDIATE, ADVANCED）
  - vibe: セッション雰囲気（CASUAL, COMPETITIVE, ACADEMY, LANGUAGE_EXCHANGE）
  - dateRange: 日付範囲（今後7日、今後14日、カスタム）
  - location: 場所・駅（複数選択可）
  - language: 言語フィルター
  - sort: ソート順（新着順、近い順、人気順）
  - limit: 1ページあたりの件数（デフォルト: 20件）
  - offset: オフセット（ページネーション用）

  Response:
  {
    "data": [
      {
        "id": "session-uuid",
        "sport": "BASKETBALL",
        "skillLevel": "INTERMEDIATE",
        "dateTime": "2024-02-15T19:00:00Z",
        "durationMinutes": 60,
        "maxParticipants": 10,
        "registeredCount": 3,
        "venue": {
          "name": "Tokyo Sports Center",
          "station": "Shinjuku",
          "latitude": 35.6895,
          "longitude": 139.6917
        },
        "vibe": "CASUAL",
        "primaryLanguage": "ja",
        "allowEnglish": true,
        "createdBy": { "id": "...", "displayName": "...", "reliabilityScore": 4.5 },
        "isFavorited": false,
        "createdAt": "2024-02-10T12:00:00Z"
      }
    ],
    "total": 150,
    "page": 1,
    "pageSize": 20
  }
  ```

- ページネーション:
  - 無限スクロール（さらに読み込み）またはページネーション（ページ数指定）
  - デフォルト: 20件/ ページ

**UI要件**:
- ホームページ（`/[locale]/`）にセッション一覧カード表示
- セッション閲覧ページ（`/[locale]/sessions`）でフィルタ付きリスト表示
- カード形式で視覚的に表示（SessionCard.tsx）
- ローディングスケルトン表示
- 検索結果なしの場合のEmptyState表示

#### 3.2.2 セッション検索・フィルター機能

**要件ID**: SS-002

**要件名**: セッション検索・フィルタリング

**説明**: ユーザーが様々な条件を組み合わせてセッションを検索するための機能である。複数の検索条件の組み合わせにより、ユーザーの興味に合致したセッションの発見を支援する。

**フィルター条件**:

1. **スポーツ種別フィルター**
   - 複数選択可能（AND条件）
   - 対象スポーツ: バスケットボール、テニス、サッカー、ヨガ、ランニング等

2. **スキルレベルフィルター**
   - 複数選択可能（AND条件）
   - レベル: 初心者（BEGINNER）、中級者（INTERMEDIATE）、上級者（ADVANCED）

3. **セッション雰囲気フィルター**
   - 複数選択可能（AND条件）
   - 雰囲気: Casual, Competitive, Academy, Language Exchange

4. **日付範囲フィルター**
   - プリセット: 今後7日、今後14日、今後30日
   - カスタム日付範囲選択可能

5. **場所・駅フィルター**
   - 複数駅選択可能
   - 駅ベースの近接検索（または緯度経度による距離検索）

6. **言語フィルター**
   - プライマリ言語: 日本語、英語
   - 英語対応セッションを含めるかどうか

7. **参加者数フィルター**
   - 満席でないセッションのみ表示（オプション）

**検索パフォーマンス**:

- フィルター条件の変更時に自動検索（デバウンス処理: 300ms）
- 検索結果のキャッシング（React Query）
- データベースインデックスによる高速化

**実装詳細**:

- フィルター状態管理:
  - URLクエリパラメータで保持（ブックマーク・共有対応）
  - 例: `/ja/sessions?sport=basketball,tennis&skillLevel=intermediate&vibe=casual&dateRange=7days`

- フロントエンド:
  - FilterPanel.tsx コンポーネント
  - 各フィルター条件の状態管理（React Hook Form）
  - リセットボタン（全フィルタクリア）
  - 適用中のフィルタ条件をバッジ表示

**UI要件**:
- セッション検索ページ（`/[locale]/sessions`）
- サイドバーまたはスライドアウトパネルでのフィルターUI
- フィルター条件の選択チェックボックス
- 適用ボタンおよびリセットボタン
- リアルタイム検索結果更新

#### 3.2.3 セッション詳細表示機能

**要件ID**: SS-003

**要件名**: セッション詳細情報の表示

**説明**: ユーザーが特定のセッションをクリックした際、そのセッションの詳細情報を表示するページである。セッション参加の判断に必要な全ての情報が提供される。

**表示情報**:

- **基本情報セクション**
  - セッションID（共有用）
  - スポーツ種別と説明
  - スキルレベル
  - セッション雰囲気
  - 言語情報（プライマリ言語、英語対応）

- **開催情報セクション**
  - 開催日時（日付、曜日、時刻）
  - 所要時間（分単位）
  - 開催場所（スポーツセンター名、正確な住所）
  - Google Maps埋め込み地図

- **参加者情報セクション**
  - 現在の参加者数 / 最大定員（「3/10」形式）
  - ウェイトリスト状態（満席の場合）
  - 参加者の簡易プロフィール一覧（最初の5人の表示名とアバター）

- **説明セクション**
  - セッション説明（日本語・英語）
  - 持ち物・服装指定
  - 特別な注記

- **主催者情報セクション**
  - 主催者の表示名、プロフィール画像
  - 信頼度スコア
  - これまでの主催セッション数
  - 主催者へのメッセージボタン

- **評価・レビュー セクション**
  - 過去のセッション評価の平均スコア（星表示）
  - 参加者からのレビューコメント（最新5件）

- **アクション セクション**
  - 参加ボタン（未登録ユーザーの場合は登録を促す）
  - ウェイトリスト追加ボタン（満席の場合）
  - 好き登録ボタン（ハート）
  - シェアボタン（メール、SNS、リンクコピー）
  - 報告ボタン（不適切内容の通報）

**実装詳細**:

- セッション詳細取得エンドポイント:
  ```
  GET /api/sessions/[sessionId]
  Response:
  {
    "id": "session-uuid",
    "sport": "BASKETBALL",
    "skillLevel": "INTERMEDIATE",
    "vibe": "CASUAL",
    "dateTime": "2024-02-15T19:00:00Z",
    "durationMinutes": 60,
    "maxParticipants": 10,
    "registeredCount": 3,
    "waitlistCount": 0,
    "descriptionEn": "Casual basketball game...",
    "descriptionJa": "カジュアルなバスケットボール...",
    "primaryLanguage": "ja",
    "allowEnglish": true,
    "venue": {
      "id": "venue-uuid",
      "nameEn": "Tokyo Sports Center",
      "nameJa": "東京スポーツセンター",
      "address": "東京都新宿区...",
      "stationEn": "Shinjuku",
      "stationJa": "新宿",
      "latitude": 35.6895,
      "longitude": 139.6917
    },
    "createdBy": {
      "id": "user-uuid",
      "displayName": "Organizer Name",
      "avatarUrl": "...",
      "reliabilityScore": 4.6,
      "totalSessionsCreated": 12
    },
    "participants": [
      { "id": "...", "displayName": "...", "avatarUrl": "..." }
    ],
    "reviews": [
      {
        "id": "review-uuid",
        "rating": 5,
        "comment": "Great session!",
        "author": { "id": "...", "displayName": "..." },
        "createdAt": "2024-02-14T20:00:00Z"
      }
    ],
    "isFavorited": false,
    "isUserRegistered": false,
    "isUserOnWaitlist": false,
    "createdAt": "2024-02-10T12:00:00Z"
  }
  ```

**UI要件**:
- セッション詳細ページ（`/[locale]/sessions/[id]`）
- スクロール可能なコンテンツレイアウト
- 粘着的なアクションバー（参加ボタン常時表示）
- SessionCard.tsxの拡張版
- レスポンシブデザイン（モバイル対応）

### 3.3 セッション参加・予約機能

#### 3.3.1 セッション参加登録機能

**要件ID**: SS-P-001

**要件名**: セッション参加予約

**説明**: ユーザーが特定のセッションへの参加を予約するための機能である。1回のクリックでセッションへの参加意思を表明できる。

**参加可能条件**:

1. ユーザーが認証済み（ログイン状態）
2. ユーザーのメールアドレスが確認済み（email_verified = true）
3. セッションが未開催（開始日時が未来）
4. 参加者数が最大定員に達していない
5. ユーザーが既に参加していない（重複登録を防止）

**実装詳細**:

- セッション参加登録エンドポイント:
  ```
  POST /api/sessions/[sessionId]/attendance
  Request Body: {}
  Response:
  {
    "id": "user-session-uuid",
    "userId": "user-uuid",
    "sessionId": "session-uuid",
    "status": "REGISTERED",
    "registeredAt": "2024-02-12T15:30:00Z",
    "attendedAt": null
  }
  ```

- トランザクション処理:
  - 同時アクセスによるオーバーブッキング防止（データベースロック）
  - 参加者数のインクリメント

- バリデーション:
  - セッションの存在確認
  - 参加可能条件の確認
  - 参加者数と定員の比較

- 通知:
  - 参加登録完了メール送信
  - セッション主催者への参加者追加通知
  - Supabase Realtimeでリアルタイム通知

**エラーハンドリング**:

- セッション満席: "このセッションはいっぱいです。ウェイトリストに登録できます。"
- 既に登録済み: "既にこのセッションに登録されています。"
- 過去のセッション: "このセッションは終了しています。"
- メール未確認: "メールアドレスの確認が必要です。"

**UI要件**:
- セッション詳細ページの参加ボタン
- クリック前の確認ダイアログ
- 参加後のボタン状態変更（「参加予約中」→「参加をキャンセル」）
- 参加完了メッセージ表示
- 参加セッション一覧への自動追加

#### 3.3.2 セッション参加キャンセル機能

**要件ID**: SS-P-002

**要件名**: セッション参加キャンセル

**説明**: ユーザーがセッションの参加登録をキャンセルするための機能である。キャンセルは開始時刻の24時間前まで可能とする。

**キャンセル可能条件**:

1. ユーザーが認証済み
2. ユーザーが当該セッションに参加登録済み
3. セッション開始時刻の24時間以上前である
4. 出席状態（ATTENDED）ではない

**実装詳細**:

- セッション参加キャンセルエンドポイント:
  ```
  DELETE /api/sessions/[sessionId]/attendance
  Response: { success: true }
  ```

- キャンセル処理:
  - UserSessionレコードの削除またはステータス変更
  - 参加者数のデクリメント
  - ウェイトリスト最上位のユーザーを自動的に登録（ウェイトリスト機能がある場合）

- 通知:
  - キャンセル確認メール送信
  - セッション主催者への参加者削除通知

**エラーハンドリング**:

- キャンセル期限超過: "開始時刻の24時間前までのみキャンセル可能です。"
- キャンセル不可状態: "このセッションはキャンセルできません。"

**UI要件**:
- セッション詳細ページの「参加をキャンセル」ボタン
- キャンセル前の確認ダイアログ（理由の入力フィールド）
- キャンセル完了メッセージ
- ユーザーの「参加予約中」セッション一覧からの削除

#### 3.3.3 セッション参加状況確認機能

**要件ID**: SS-P-003

**要件名**: ユーザーの参加セッション一覧表示

**説明**: ユーザーが自分が参加予約しているセッション、または過去に参加したセッションを閲覧する機能である。

**表示内容**:

- **今後のセッション**
  - 参加予約済みセッション（開始日時が未来）
  - セッション情報（日時、場所、スポーツ、主催者）
  - キャンセルボタン（24時間以上前の場合）

- **過去のセッション**
  - 参加済み / 参加予定済み（出席済みのみ）
  - セッション情報
  - レビュー・評価ボタン
  - 過去のレビュー表示

**実装詳細**:

- ユーザーの参加セッション取得エンドポイント:
  ```
  GET /api/users/me/sessions?status=upcoming&sort=dateTime
  Response:
  {
    "upcoming": [
      {
        "id": "user-session-uuid",
        "session": { /* セッション詳細 */ },
        "status": "REGISTERED",
        "registeredAt": "2024-02-12T15:30:00Z",
        "attendedAt": null
      }
    ],
    "past": [
      {
        "id": "user-session-uuid",
        "session": { /* セッション詳細 */ },
        "status": "ATTENDED",
        "registeredAt": "2024-02-01T15:30:00Z",
        "attendedAt": "2024-02-01T20:30:00Z"
      }
    ]
  }
  ```

**UI要件**:
- ユーザープロフィールの「参加セッション」セクション
- 「今後のセッション」と「過去のセッション」タブ
- セッションカード形式の表示
- ソート機能（日付順、最近順）

### 3.4 ウェイトリスト機能

#### 3.4.1 ウェイトリスト登録機能

**要件ID**: SS-W-001

**要件名**: ウェイトリスト登録

**説明**: セッションが満席の場合、ユーザーはウェイトリストに登録することで、キャンセルが出た際に自動的に参加登録されることを希望できる機能である。

**実装詳細**:

- ウェイトリスト登録エンドポイント:
  ```
  POST /api/sessions/[sessionId]/waitlist
  Response:
  {
    "id": "waitlist-uuid",
    "userId": "user-uuid",
    "sessionId": "session-uuid",
    "position": 3,
    "registeredAt": "2024-02-12T15:30:00Z",
    "notified": false
  }
  ```

- ウェイトリスト処理:
  - ウェイトリスト登録時、ユーザーに確認メール送信
  - ウェイトリストの位置を通知
  - キャンセルが発生時、最上位のユーザーを自動登録
  - 自動登録ユーザーに通知メール送信

**UI要件**:
- セッション詳細ページの「ウェイトリストに登録」ボタン（満席時）
- ウェイトリスト登録状態の表示
- ウェイトリストの位置情報表示

---

## 第4章 セッション作成・管理機能

### 4.1 セッション作成機能

#### 4.1.1 セッション新規作成機能

**要件ID**: SM-001

**要件名**: スポーツセッション新規作成

**説明**: オーガナイザー（セッション主催者権限を持つユーザー）が新しいスポーツセッションを企画・作成するための機能である。セッション作成は、複数ステップのフォーム入力により、詳細な情報を段階的に入力する。

**セッション作成に必要な情報**:

1. **基本情報ステップ**
   - スポーツ種別（ドロップダウン選択）
   - スキルレベル（初心者、中級者、上級者）
   - セッション雰囲気（Casual, Competitive, Academy, Language Exchange）

2. **開催情報ステップ**
   - 開催日付（日付ピッカー）
   - 開催時刻（時刻ピッカー）
   - 所要時間（ドロップダウン: 30分、45分、60分、90分など）
   - スポーツセンター（複数選択可能、Google Mapsでも検索可）

3. **言語設定ステップ**
   - プライマリ言語（日本語 / 英語）
   - 英語話者の参加を許可するか（はい / いいえ）

4. **参加者設定ステップ**
   - 最大参加者数（5～100人）
   - 最小スキルレベル（オプション）

5. **説明・詳細ステップ**
   - セッション説明（日本語と英語）
   - 持ち物指定
   - 特別な注記（例: 初回の者は事前連絡が必要）

**実装詳細**:

- セッション新規作成エンドポイント:
  ```
  POST /api/sessions
  Request Body:
  {
    "sport": "BASKETBALL",
    "skillLevel": "INTERMEDIATE",
    "vibe": "CASUAL",
    "dateTime": "2024-02-15T19:00:00Z",
    "durationMinutes": 60,
    "maxParticipants": 10,
    "sportCenterId": "venue-uuid",
    "primaryLanguage": "ja",
    "allowEnglish": true,
    "descriptionEn": "Casual basketball game...",
    "descriptionJa": "カジュアルなバスケットボール..."
  }
  Response:
  {
    "id": "session-uuid",
    "createdBy": "user-uuid",
    "createdAt": "2024-02-10T12:00:00Z",
    "status": "PUBLISHED"
  }
  ```

- バリデーション:
  - 開催日時が現在時刻より未来であることを確認
  - スポーツセンターの存在確認
  - 説明文の文字数制限（最大1000文字）

- セッション状態:
  - DRAFT（下書き）: 作成中、公開前
  - PUBLISHED（公開）: 参加予約受付中
  - CANCELLED（キャンセル）: 開催中止

**UI要件**:
- セッション作成ページ（`/[locale]/sessions/create`）
- マルチステップフォーム（段階的入力）
- 各ステップの入力内容プレビュー
- バリデーションエラー表示
- 保存（下書き）ボタン
- 公開ボタン

#### 4.1.2 セッション編集・更新機能

**要件ID**: SM-002

**要件名**: セッション情報の編集・更新

**説明**: セッション作成者が、作成したセッションの情報を編集・更新するための機能である。開催日時が近づいている場合など、編集に制限が設けられる。

**編集可能条件**:

- セッション作成者本人（またはAdmin）
- セッション開始時刻の7日以上前

**編集可能フィールド**:

- セッション雰囲気
- 説明（日本語・英語）
- 最大参加者数（既に登録済みの参加者数より少なくできない）
- スポーツセンター

**編集不可フィールド**:

- スポーツ種別
- スキルレベル
- 開催日時（キャンセルして新規作成が必要）
- 言語設定

**実装詳細**:

- セッション編集エンドポイント:
  ```
  PATCH /api/sessions/[sessionId]
  Request Body:
  {
    "vibe": "COMPETITIVE",
    "descriptionEn": "Updated description...",
    "maxParticipants": 15
  }
  Response: { success: true, updatedFields: [...] }
  ```

- 編集時の通知:
  - セッション参加者への変更通知メール送信
  - プッシュ通知

**エラーハンドリング**:

- 編集期限超過: "セッション開始の7日以内は編集できません。キャンセルして新規作成してください。"
- 権限なし: "このセッションを編集する権限がありません。"

**UI要件**:
- セッション編集ページ（`/[locale]/sessions/[id]/edit`）
- 編集不可フィールドのグレイアウト
- 変更内容の確認ダイアログ
- 変更完了メッセージ

#### 4.1.3 セッションキャンセル機能

**要件ID**: SM-003

**要件名**: セッションキャンセル

**説明**: セッション作成者がセッションをキャンセルする機能である。キャンセル時には、すべての参加者に通知が送信される。

**キャンセル可能条件**:

- セッション作成者本人（またはAdmin）

**実装詳細**:

- セッションキャンセルエンドポイント:
  ```
  DELETE /api/sessions/[sessionId]
  Request Body:
  {
    "cancellationReason": "突然の仕事が入ってしまいました..."
  }
  Response: { success: true }
  ```

- キャンセル処理:
  - セッション状態をCANCELLEDに更新
  - すべての参加者に キャンセル通知メール送信
  - キャンセル理由を記録

**UI要件**:
- セッション詳細ページの「セッションをキャンセル」ボタン（作成者のみ表示）
- キャンセル理由の入力フィールド
- キャンセル前の最終確認ダイアログ
- キャンセル完了メッセージ

### 4.2 セッション参加者管理機能

#### 4.2.1 参加者一覧表示機能

**要件ID**: SM-P-001

**要件名**: セッション参加者一覧表示

**説明**: セッション作成者が、そのセッションに登録した参加者の一覧を閲覧するための機能である。参加者の詳細情報、出席状況などが表示される。

**表示情報**:

- 参加者の表示名、プロフィール画像、信頼度スコア
- スポーツスキルレベル
- 登録日時
- 出席状況（未確定、出席、欠席）
- 参加者への操作（メッセージ送信、削除）

**実装詳細**:

- セッション参加者一覧取得エンドポイント:
  ```
  GET /api/sessions/[sessionId]/participants
  Response:
  {
    "participants": [
      {
        "id": "user-uuid",
        "displayName": "User Name",
        "avatarUrl": "...",
        "reliabilityScore": 4.5,
        "skillLevel": "INTERMEDIATE",
        "registeredAt": "2024-02-12T15:30:00Z",
        "status": "REGISTERED"
      }
    ],
    "totalCount": 8,
    "attendedCount": null
  }
  ```

**UI要件**:
- セッション管理ページの「参加者」タブ
- 参加者リスト表示
- 参加者の削除ボタン
- メッセージ送信ボタン

#### 4.2.2 出席確認機能

**要件ID**: SM-P-002

**要件名**: セッション出席確認・マーク

**説明**: セッション開催後、作成者がセッション参加者の出席・欠席を確認し、記録する機能である。

**実装詳細**:

- 出席確認エンドポイント:
  ```
  POST /api/sessions/[sessionId]/mark-attendance
  Request Body:
  {
    "userId": "user-uuid",
    "status": "ATTENDED"  // または "NO_SHOW"
  }
  Response: { success: true }
  ```

- 出席マーク処理:
  - UserSessionレコードのステータス更新（ATTENDED / NO_SHOW）
  - 出席確認日時を記録（attended_at）
  - 欠席の場合、no_show_countをインクリメント
  - 欠席ユーザーの信頼度スコア低下

- 通知:
  - 出席確認ユーザーへの確認メール送信
  - 欠席マークの場合、警告メール送信

**UI要件**:
- セッション終了後、作成者向けの「出席確認」ページ
- 参加者リストのチェックボックス（出席・欠席選択）
- 一括出席マーク機能
- 個別出席マーク機能
- 未確認ユーザーのハイライト

---

## 第5章 コミュニケーション・チャット機能

### 5.1 セッション内チャット機能

#### 5.1.1 セッション別チャットルーム機能

**要件ID**: CM-001

**要件名**: セッション別リアルタイムチャット

**説明**: セッションの参加者同士がリアルタイムで会話できるチャット機能である。Supabase Realtimeを活用し、WebSocketによる即時配信を実現する。

**チャット機能**:

- 各セッションに専用チャットルームを自動作成
- セッション参加者のみがアクセス可能
- メッセージの即時配信（遅延なし）
- メッセージ履歴の保存
- 参加者一覧の表示
- オンライン状態（ユーザーの接続状態）の表示

**実装詳細**:

- チャット取得エンドポイント:
  ```
  GET /api/sessions/[sessionId]/messages?limit=50&offset=0
  Response:
  {
    "messages": [
      {
        "id": "message-uuid",
        "conversationId": "conversation-uuid",
        "senderId": "user-uuid",
        "senderName": "User Name",
        "content": "こんにちは！",
        "createdAt": "2024-02-15T19:15:00Z"
      }
    ],
    "totalCount": 150
  }
  ```

- メッセージ送信エンドポイント:
  ```
  POST /api/sessions/[sessionId]/messages
  Request Body:
  {
    "content": "このセッション楽しみです！"
  }
  Response: { id: "message-uuid", createdAt: "..." }
  ```

- Supabase Realtime設定:
  - チャンネル名: `session-[sessionId]`
  - イベントタイプ: `message:new`
  - ペイロード: メッセージ全情報

**メッセージ制限**:

- 1メッセージの最大文字数: 500文字
- 1分あたりの送信制限: 10メッセージ（レート制限）
- 禁止ワード・スパム検出（自動フィルタリング）

**エモジアンド絵文字対応**:

- Unicode絵文字の完全対応
- 絵文字ピッカー（UI）

**UI要件**:
- セッション詳細ページの「チャット」タブ
- ChatBox.tsx コンポーネント
- メッセージバブル表示（送信者と受信者で区別）
- タイムスタンプ表示
- 参加者アバター表示
- スクロール自動更新（新メッセージ到着時に下へスクロール）
- 読込中スケルトン表示

#### 5.1.2 ダイレクトメッセージ機能

**要件ID**: CM-002

**要件名**: ユーザー間ダイレクトメッセージ

**説明**: セッション参加者同士が、セッション外でダイレクトメッセージを交換できる機能である。セッション主催者と参加者の事前連絡などに活用される。

**実装詳細**:

- DM作成エンドポイント:
  ```
  POST /api/conversations
  Request Body:
  {
    "recipientId": "user-uuid"
  }
  Response:
  {
    "id": "conversation-uuid",
    "createdAt": "2024-02-15T10:00:00Z"
  }
  ```

- DM一覧取得エンドポイント:
  ```
  GET /api/conversations?type=direct&sort=lastMessage
  Response:
  {
    "conversations": [
      {
        "id": "conversation-uuid",
        "type": "DIRECT",
        "participantId": "user-uuid",
        "participantName": "User Name",
        "participantAvatar": "...",
        "lastMessage": "次のセッションはいつ？",
        "lastMessageTime": "2024-02-15T19:30:00Z",
        "unreadCount": 2
      }
    ]
  }
  ```

- メッセージ送受信エンドポイント:
  ```
  POST /api/conversations/[conversationId]/messages
  Request Body: { "content": "..." }
  Response: { id: "message-uuid", ... }

  GET /api/conversations/[conversationId]/messages
  Response: { messages: [...], totalCount: ... }
  ```

**通知**:

- 新規メッセージ到着時にプッシュ通知
- メッセージ未読カウント
- 既読・未読ステータス

**UI要件**:
- DM一覧ページ（`/[locale]/messages`）
- DM詳細ページ
- 新規DM作成ボタン
- ナビゲーションバーのメッセージアイコン（未読カウント表示）
- メッセージ通知バッジ

### 5.2 プッシュ通知機能

#### 5.2.1 通知種別と配信

**要件ID**: CM-N-001

**要件名**: システム通知機能

**説明**: ユーザーに対して、セッション関連イベント、メッセージ受信、レビュー受取などのシステム通知を配信する機能である。メール通知とアプリ内通知の両方で実現される。

**通知種別**:

1. **セッション関連**
   - セッション開始1時間前のリマインダー
   - セッション開始日時が変更された
   - セッションがキャンセルされた
   - 新しいメッセージがセッションチャットに投稿された
   - ウェイトリストの順位が繰り上がった（参加可能になった）

2. **メッセージ関連**
   - ダイレクトメッセージ受信
   - セッションチャットでメンション（@mention）されました

3. **評価・レビュー関連**
   - セッションに新しいレビュー/評価が投稿された

4. **アカウント関連**
   - メール確認メール送信
   - パスワードリセット通知
   - 不審なログイン検出

**通知フィルターと設定**:

- ユーザーが通知の種別ごとにメール・プッシュ通知のON/OFFを設定可能
- 通知の時間帯制限（例: 深夜は通知しない）

**実装詳細**:

- 通知取得エンドポイント:
  ```
  GET /api/notifications?limit=20&offset=0&read=false
  Response:
  {
    "notifications": [
      {
        "id": "notification-uuid",
        "type": "SESSION_REMINDER",
        "title": "セッション開始まであと1時間",
        "message": "バスケットボール セッションが1時間後に開始します",
        "relatedSessionId": "session-uuid",
        "read": false,
        "createdAt": "2024-02-15T18:00:00Z"
      }
    ],
    "totalCount": 35,
    "unreadCount": 5
  }
  ```

- 通知既読処理エンドポイント:
  ```
  PATCH /api/notifications/[notificationId]/read
  Response: { success: true }
  ```

- メール送信（非同期ジョブ）:
  - Resendサービスを使用
  - HTMLテンプレート（日本語・英語）
  - リンク含有（セッション詳細ページなど）

**UI要件**:
- ナビゲーションバーの通知ベル（未読カウント表示）
- 通知センターページ（`/[locale]/notifications`）
- 通知リスト表示
- 通知クリックでセッションまたはメッセージへ移動
- 既読・未読トグル
- 一括既読機能
- 通知設定ページ（ユーザー設定から）

---

## 第6章 評価・レビュー・信頼機能

### 6.1 セッション評価・レビュー機能

#### 6.1.1 セッション評価機能

**要件ID**: RV-001

**要件名**: セッション評価・レビュー投稿

**説明**: セッション参加者が、セッション終了後に、開催状況などについて5段階評価およびコメントを投稿する機能である。

**評価対象**:

- セッションの開催状況（事前の説明と一致したか）
- セッションの雰囲気（説明と一致したか）
- セッション主催者の対応
- セッション参加者の雰囲気
- 施設・場所について

**評価データ**:

- 5段階星評価（1～5）
- コメント（任意、最大500文字）
- 評価投稿日時

**実装詳細**:

- レビュー投稿エンドポイント:
  ```
  POST /api/sessions/[sessionId]/reviews
  Request Body:
  {
    "rating": 5,
    "comment": "素晴らしいセッションでした！主催者の準備が良く、参加者も皆さん親切でした。"
  }
  Response:
  {
    "id": "review-uuid",
    "sessionId": "session-uuid",
    "authorId": "user-uuid",
    "rating": 5,
    "comment": "...",
    "createdAt": "2024-02-15T21:00:00Z"
  }
  ```

- レビュー取得エンドポイント:
  ```
  GET /api/sessions/[sessionId]/reviews
  Response:
  {
    "reviews": [
      {
        "id": "review-uuid",
        "author": {
          "id": "user-uuid",
          "displayName": "User Name",
          "avatarUrl": "..."
        },
        "rating": 5,
        "comment": "...",
        "createdAt": "2024-02-15T21:00:00Z"
      }
    ],
    "averageRating": 4.7,
    "totalReviews": 8
  }
  ```

**バリデーション**:

- 1ユーザー1セッション1評価のみ（重複評価を防止）
- セッション終了後のみ評価可能（終了24時間以内を推奨）
- 参加したユーザーのみが評価可能

**エラーハンドリング**:

- "既にこのセッションを評価済みです。"
- "このセッションはまだ終了していません。"
- "このセッションに参加していません。"

**UI要件**:
- セッション詳細ページの「レビュー」セクション
- 過去のセッション一覧の「評価する」ボタン
- レビュー投稿モーダル（星評価とコメント入力）
- 既存レビュー表示（著者、星、コメント、日付）
- 平均評価スコア表示

### 6.2 ユーザー信頼度スコア機能

#### 6.2.1 信頼度スコア計算機能

**要件ID**: TR-001

**要件名**: ユーザー信頼度スコア管理

**説明**: ユーザーの信頼度スコアは、複数の要素に基づいて自動的に計算・更新される。スコアは1.0～5.0の範囲であり、プロフィールに表示される。

**スコア計算要素**:

1. **セッション参加実績** (40%)
   - セッション参加数が多いほどスコア向上
   - 欠席（no_show）するとスコア低下（-0.2ポイント/回）

2. **他ユーザーからの評価** (40%)
   - セッション終了後の評価スコアの平均
   - 複数の評価があるほどスコア信頼度が向上

3. **メール確認・電話確認** (10%)
   - メールアドレス確認: +0.3ポイント
   - 電話番号確認: +0.2ポイント
   - 学生認証: +0.2ポイント

4. **プロフィール完成度** (10%)
   - 自己紹介があるか
   - プロフィール画像の有無
   - スポーツ情報の入力度

**スコア変動ルール**:

- 初期値: 1.0
- 最大値: 5.0
- 最小値: 0.5（バンしない限り）
- 更新タイミング: リアルタイム（評価投稿時、欠席確認時）

**実装詳細**:

- スコア計算関数（lib/trustScore.ts）:
  - セッション参加数、評価平均、認証状態、プロフィール情報から算出
  - PostgreSQL関数またはアプリケーションロジックで実装

- スコア表示:
  - ユーザープロフィール右上に「4.7 ⭐」と表示
  - セッション詳細の主催者情報に表示
  - セッション参加者リストに表示

**UI要件**:
- 信頼度スコアの視覚的表示（星マーク）
- スコア詳細情報（マウスホバーでツールチップ表示）
- スコア向上のための提案（メール確認、プロフィール完成など）

### 6.3 ユーザーレビュー機能

#### 6.3.1 ユーザーレビュー投稿機能

**要件ID**: TR-002

**要件名**: ユーザーレビュー（ユーザー評価）

**説明**: セッション参加者が、他の参加者またはセッション主催者に対してレビューを投稿する機能である。セッション終了後、「この人は素晴らしかった」といった評価を記録できる。

**実装方針**:

- セッション評価（SM-001）と区別し、個別のユーザーレビューテーブルを作成
- または、セッション評価に含める形で実装（フェーズ2以降）

**今後の実装**:

- リリース後のフェーズアップで追加予定

---

## 第7章 好きリスト・お気に入り機能

### 7.1 セッション好き登録機能

**要件ID**: FB-001

**要件名**: セッション好き・ブックマーク機能

**説明**: ユーザーが興味あるセッションをハート（好き）ボタンでマークし、後で参照できる機能である。お気に入りセッション一覧ページで、マークしたセッションを一覧表示できる。

**実装詳細**:

- セッション好き登録エンドポイント:
  ```
  POST /api/sessions/[sessionId]/favorite
  Response: { success: true }
  ```

- セッション好き解除エンドポイント:
  ```
  DELETE /api/sessions/[sessionId]/favorite
  Response: { success: true }
  ```

- お気に入りセッション一覧取得エンドポイント:
  ```
  GET /api/users/me/favorites?sort=markedAt&limit=20&offset=0
  Response:
  {
    "favorites": [
      {
        "id": "favorite-uuid",
        "session": { /* セッション詳細 */ },
        "markedAt": "2024-02-12T15:30:00Z"
      }
    ],
    "totalCount": 12
  }
  ```

- バリデーション:
  - ログインユーザーのみ（ゲストユーザーは好きできない）
  - 1セッション1好きのみ（重複登録を防止）

**UI要件**:
- セッションカードのハートボタン
- セッション詳細ページのハートボタン
- お気に入りセッション一覧ページ（`/[locale]/favorites`）
- お気に入りの削除ボタン
- ハートボタンの状態変化（アニメーション）

---

## 第8章 報告・モデレーション機能

### 8.1 不適切内容報告機能

#### 8.1.1 セッション・ユーザー報告機能

**要件ID**: MD-001

**要件名**: セッション・ユーザーの不適切内容報告

**説明**: ユーザーが、セッションまたはユーザーの不適切な内容（スパム、ハラスメント、詐欺的行為など）をプラットフォームに報告する機能である。報告内容は管理者に集約され、調査・対応の対象となる。

**報告対象**:

- セッション（不正な勧誘、虚偽の説明など）
- ユーザー（ハラスメント、詐欺的行為、不誠実な振る舞い）

**報告理由カテゴリ**:

1. ハラスメント（HARASSMENT）
2. 欠席（NO_SHOW）
3. スパム・迷惑行為（SPAM）
4. 不適切な行動（CREEPY_BEHAVIOR）
5. 偽りのプロフィール（FAKE_PROFILE）
6. その他（OTHER）

**実装詳細**:

- 報告投稿エンドポイント:
  ```
  POST /api/reports
  Request Body:
  {
    "reportedUserId": "user-uuid",  // reportedSessionIdとどちらか一つ
    "reportedSessionId": null,
    "reason": "HARASSMENT",
    "description": "セッション中に不適切な言動がありました..."
  }
  Response:
  {
    "id": "report-uuid",
    "status": "PENDING",
    "createdAt": "2024-02-15T15:30:00Z"
  }
  ```

- 報告一覧取得（管理者用）:
  ```
  GET /api/admin/reports?status=PENDING&sort=createdAt
  Response:
  {
    "reports": [
      {
        "id": "report-uuid",
        "reporterId": "...",
        "reportedUserId": "...",
        "reason": "HARASSMENT",
        "description": "...",
        "status": "PENDING",
        "createdAt": "2024-02-15T15:30:00Z"
      }
    ],
    "totalCount": 8
  }
  ```

**バリデーション**:

- 報告者がログイン中
- 報告対象（ユーザーまたはセッション）の存在確認
- 自分自身の報告を防止

**UI要件**:
- セッション詳細ページの「報告する」ボタン
- ユーザープロフィールの「報告する」ボタン
- 報告モーダル（理由選択、説明入力）
- 報告完了メッセージ
- 重複報告警告

### 8.2 管理者モデレーション機能

#### 8.2.1 報告管理機能（管理者用）

**要件ID**: MD-A-001

**要件名**: 報告管理・調査・対応（管理者用）

**説明**: 管理者が報告内容を調査し、適切な対応を実施する機能である。ユーザーのバン、セッションの削除、警告メール送信などが含まれる。

**報告ステータス遷移**:

- PENDING（保留中）→ REVIEWED（確認済み）→ RESOLVED（解決）
- または DISMISSED（却下）

**対応オプション**:

1. 却下（DISMISS）: 問題なしと判断
2. 警告メール送信: ユーザーに警告を通知
3. ユーザーバン（一時）: 7日～30日間のアクセス制限
4. ユーザーバン（永続）: アカウント削除
5. セッション削除: セッション削除
6. その他の調査継続

**実装詳細**:

- 報告詳細確認エンドポイント:
  ```
  GET /api/admin/reports/[reportId]
  Response: { /* 報告詳細情報 */ }
  ```

- 報告対応エンドポイント:
  ```
  PATCH /api/admin/reports/[reportId]
  Request Body:
  {
    "status": "REVIEWED",
    "action": "BAN_USER_TEMPORARY",
    "banDurationDays": 30,
    "notes": "複数の報告があるため30日間のバンを実施"
  }
  Response: { success: true }
  ```

- ユーザーバン処理:
  - Userテーブルの is_banned フラグをtrueに設定
  - 自動復旧スケジュール（一時バン場合）
  - バンしたユーザーのセッションアクセス制限

- 通知:
  - ユーザーへのバン通知メール
  - バン理由の説明
  - バン解除予定日時（一時バン場合）

**UI要件**:
- 管理画面の報告管理ページ（`/[locale]/admin/reports`）
- 報告一覧（PENDINGステータスが優先表示）
- 報告詳細ページ（報告内容、対象ユーザー/セッション情報）
- 対応アクション選択フォーム
- 対応履歴表示

---

## 第9章 管理者機能

### 9.1 ユーザー管理機能

#### 9.1.1 ユーザー一覧・検索機能（管理者用）

**要件ID**: AM-001

**要件名**: ユーザー管理・検索（管理者用）

**説明**: 管理者がプラットフォームのユーザー一覧を表示し、検索・フィルタリングするための機能である。

**検索・フィルター機能**:

- 表示名またはメールアドレスでの検索
- ステータスフィルター（アクティブ、バン中、削除済み）
- 登録日付範囲フィルター
- ソート（登録日時、信頼度スコア）

**実装詳細**:

- ユーザー一覧取得エンドポイント:
  ```
  GET /api/admin/users?search=...&status=...&sort=...&limit=50&offset=0
  Response:
  {
    "users": [
      {
        "id": "user-uuid",
        "email": "user@example.com",
        "displayName": "User Name",
        "reliabilityScore": 4.2,
        "isBanned": false,
        "sessionsCreated": 5,
        "sessionsAttended": 12,
        "createdAt": "2024-01-15T10:30:00Z"
      }
    ],
    "totalCount": 250
  }
  ```

**UI要件**:
- 管理画面のユーザー一覧ページ（`/[locale]/admin/users`）
- ユーザー検索フォーム
- ユーザーテーブル（メール、表示名、スコア、バン状態）
- ページネーション

#### 9.1.2 ユーザー詳細情報表示・編集機能（管理者用）

**要件ID**: AM-002

**要件名**: ユーザー詳細編集（管理者用）

**説明**: 管理者が特定のユーザーの詳細情報を確認し、編集・処分を実施するための機能である。

**表示・編集可能情報**:

- 基本プロフィール（メール、名前、画像など）
- アカウント状態（バン中、確認済みなど）
- 活動履歴（セッション作成・参加数）
- 信頼度スコア詳細
- 報告・苦情履歴

**管理アクション**:

1. ユーザー一時バン（7～30日間）
2. ユーザー永続バン（アカウント削除）
3. 警告メール送信
4. プロフィール情報の編集・削除
5. ユーザーステータスの変更

**実装詳細**:

- ユーザー詳細取得エンドポイント:
  ```
  GET /api/admin/users/[userId]
  Response:
  {
    "id": "user-uuid",
    "email": "user@example.com",
    "displayName": "User Name",
    "profile": { /* 詳細プロフィール */ },
    "reliabilityScore": 4.2,
    "isBanned": false,
    "banHistory": [ /* バン履歴 */ ],
    "reports": [ /* 関連報告 */ ],
    "createdAt": "2024-01-15T10:30:00Z"
  }
  ```

- ユーザー編集エンドポイント:
  ```
  PATCH /api/admin/users/[userId]
  Request Body:
  {
    "action": "BAN",
    "banDurationDays": 7,
    "reason": "複数のハラスメント報告"
  }
  Response: { success: true }
  ```

**UI要件**:
- ユーザー詳細ページ（`/[locale]/admin/users/[userId]`）
- プロフィール情報表示
- 活動統計表示
- バン・警告アクションフォーム
- 報告・バン履歴タイムライン

### 9.2 スポーツセンター管理機能

#### 9.2.1 スポーツセンター一覧・CRUD機能（管理者用）

**要件ID**: AM-FC-001

**要件名**: スポーツセンター管理（管理者用）

**説明**: 管理者がプラットフォームで利用可能なスポーツセンターの情報を管理する機能である。新規追加、情報更新、削除が可能である。

**スポーツセンター情報**:

- 施設名（日本語・英語）
- 住所（郵便番号、都道府県、市区町村、番地）
- 最寄り駅（日本語・英語）
- 緯度経度（Google Maps用）
- 施設画像
- アクセス情報（交通機関の説明）
- 備考

**実装詳細**:

- スポーツセンター一覧取得エンドポイント:
  ```
  GET /api/admin/sport-centers?sort=name&limit=50
  Response:
  {
    "centers": [
      {
        "id": "venue-uuid",
        "nameEn": "Tokyo Sports Center",
        "nameJa": "東京スポーツセンター",
        "address": "東京都新宿区...",
        "stationEn": "Shinjuku",
        "stationJa": "新宿",
        "latitude": 35.6895,
        "longitude": 139.6917
      }
    ],
    "totalCount": 45
  }
  ```

- スポーツセンター新規作成エンドポイント:
  ```
  POST /api/admin/sport-centers
  Request Body:
  {
    "nameEn": "New Sports Center",
    "nameJa": "新しいスポーツセンター",
    "address": "...",
    "stationEn": "Station Name",
    "stationJa": "駅名",
    "latitude": 35.6895,
    "longitude": 139.6917
  }
  Response: { id: "venue-uuid", ... }
  ```

- スポーツセンター編集エンドポイント:
  ```
  PATCH /api/admin/sport-centers/[centerId]
  Request Body: { /* 更新情報 */ }
  Response: { success: true }
  ```

- スポーツセンター削除エンドポイント:
  ```
  DELETE /api/admin/sport-centers/[centerId]
  Response: { success: true }
  ```

**バリデーション**:

- 緯度経度の形式確認
- 住所の重複チェック

**UI要件**:
- スポーツセンター一覧ページ（`/[locale]/admin/sport-centers`）
- 新規作成フォーム
- 編集フォーム
- Google Maps埋め込み（位置確認）

### 9.3 プラットフォーム統計・ダッシュボード機能

#### 9.3.1 管理者ダッシュボード機能

**要件ID**: AM-DB-001

**要件名**: 管理者ダッシュボード・プラットフォーム統計

**説明**: 管理者が、プラットフォーム全体の統計情報、キーメトリクスをリアルタイムで確認できるダッシュボード機能である。

**表示情報**:

- **ユーザー統計**
  - 総ユーザー数
  - 月間新規登録数
  - アクティブユーザー数（月間）
  - バン中のユーザー数

- **セッション統計**
  - 総セッション数
  - 今月のセッション数
  - キャンセルされたセッション数
  - 平均参加者数

- **関与度メトリクス**
  - 平均信頼度スコア
  - セッション平均評価スコア
  - 報告件数（未解決）
  - メッセージ総数（日次）

- **財務・収益関連**（将来の有料化対応）
  - プレミアムユーザー数
  - 月間収益

- **グラフ表示**
  - ユーザー増加トレンド（月別）
  - セッション数トレンド（月別）
  - 報告件数トレンド

**実装詳細**:

- 統計データ取得エンドポイント:
  ```
  GET /api/admin/stats?period=monthly&from=2024-01-01&to=2024-02-01
  Response:
  {
    "userStats": {
      "totalUsers": 850,
      "newUsersThisMonth": 120,
      "activeUsersThisMonth": 450,
      "bannedUsers": 5
    },
    "sessionStats": {
      "totalSessions": 180,
      "sessionsThisMonth": 42,
      "cancelledSessions": 3,
      "averageParticipants": 7.2
    },
    "engagementStats": {
      "averageTrustScore": 3.8,
      "averageSessionRating": 4.5,
      "pendingReports": 8,
      "totalMessages": 1250
    },
    "trends": [
      { "date": "2024-01-01", "newUsers": 15, "newSessions": 3 }
    ]
  }
  ```

- ダッシュボードキャッシング:
  - 統計データは定期的に更新（1時間ごと）
  - Redis cache活用で高速化

**UI要件**:
- 管理ダッシュボードページ（`/[locale]/admin`）
- KPI カードの大きな表示
- グラフ表示（Chart.js / Recharts）
- 期間選択フィルター
- リアルタイム更新オプション

---

## 第10章 国際化・多言語対応

### 10.1 多言語UI対応

**要件ID**: I18N-001

**要件名**: 多言語ユーザーインターフェース

**説明**: ユーザーが日本語または英語でプラットフォームを利用できるよう、全UI要素を多言語化する。

**対応言語**:

- 日本語（ja）
- 英語（en）

**実装方式**:

- next-intlライブラリを使用
- URL パスにロケール情報を含有（`/ja/...`, `/en/...`）
- ユーザープリファレンスで言語を保存
- ブラウザの言語設定で自動検出

**翻訳対象**:

- 全ナビゲーションメニュー
- ボタンラベル
- エラーメッセージ
- 確認ダイアログ
- フォームラベル
- ドキュメント・ヘルプテキスト

**実装詳細**:

- `/messages` ディレクトリに翻訳ファイル（JSON/YAML形式）
- 各ページ・コンポーネントで `useTranslations()` hook を使用

**UI要件**:
- ナビゲーションバーに言語切り替えボタン
- ユーザー設定で推奨言語設定
- 自動検出による初回言語選択

### 10.2 セッション言語対応

**要件ID**: I18N-SS-001

**要件名**: セッション別言語設定

**説明**: セッション作成時に、セッションのプライマリ言語および英語対応フラグを設定できる機能である。多言語ユーザーの参加機会を拡大する。

**実装詳細**:

- セッション作成フォームで言語選択
- 既に仕様に含まれ（第4章 SM-001参照）

---

## 第11章 セキュリティ・プライバシー要件

### 11.1 認証・認可

#### 11.1.1 パスワードセキュリティ

**要件ID**: SEC-A-001

**要件名**: パスワードセキュリティ

**説明**:

- 最小文字数: 8文字
- 必須要素: 大文字、小文字、数字、記号を含む
- ハッシング: Argon2によるハッシング
- パスワードリセット機能: 確認メールベースの安全なリセット

#### 11.1.2 セッション管理

**要件ID**: SEC-A-002

**要件名**: ユーザーセッション管理

**説明**:

- JWT トークン有効期限: 7日間
- リフレッシュトークン有効期限: 30日間
- 複数デバイスでの同時ログイン: 上限なし（各デバイスで独立したトークン）
- ログアウト時: トークンの無効化

#### 11.1.3 API認可

**要件ID**: SEC-A-003

**要件名**: API エンドポイント認可

**説明**:

- 全保護エンドポイント（GET /api/users/me など）にJWT検証を実装
- middleware.ts でのグローバル認証チェック
- 役割ベースのアクセス制御（RBAC）: Admin, User
- リソースオーナー検証（ユーザーが自身のリソースのみアクセス可能）

### 11.2 データセキュリティ

#### 11.2.1 データ暗号化

**要件ID**: SEC-D-001

**要件名**: データ転送の暗号化

**説明**:

- 全通信: TLS 1.3以上で暗号化
- httpOnlyクッキー: XSS攻撃対策
- SameSite属性設定: CSRF攻撃対策

#### 11.2.2 個人情報保護

**要件ID**: SEC-D-002

**要件名**: 個人情報の取り扱い

**説明**:

- メールアドレス: 登録必須、第三者との共有なし
- 電話番号: オプション、暗号化保存
- プロフィール情報: 公開情報は制限（ブロック機能）
- データ削除: ユーザー自身またはAdmin管理者が削除要求可能

#### 11.2.3 入力検証

**要件ID**: SEC-D-003

**要件名**: ユーザー入力検証

**説明**:

- フロントエンド: Zod スキーマで形式検証
- バックエンド: 全入力値を再度検証（二重検証）
- SQLインジェクション対策: Prisma ORM使用
- XSS対策: HTML/Script エスケープ処理

### 11.3 プライバシー

#### 11.3.1 プライバシーポリシー

**要件ID**: PRI-001

**要件名**: プライバシーポリシー

**説明**: プラットフォームがユーザーの個人情報をどのように収集・使用・保護するか明記したプライバシーポリシーをウェブサイトに掲載する。

**掲載内容**:

- 収集する情報の種類
- 情報の利用目的
- 第三者との共有
- ユーザーの権利（アクセス、削除、修正）
- クッキー・トラッキング
- 連絡先情報

**UI要件**:
- プライバシーポリシーページ（`/[locale]/privacy`）
- 利用規約ページ（`/[locale]/terms`）
- 登録時の同意チェックボックス

#### 11.3.2 データエクスポート・削除機能

**要件ID**: PRI-002

**要件名**: ユーザーデータのエクスポート・削除

**説明**: GDPR等の規制対応として、ユーザーが自身のデータをエクスポートしたり、アカウント削除をリクエストできる機能。

**実装詳細**:

- データエクスポート要求エンドポイント:
  ```
  POST /api/users/me/export-data
  Response: { requestId: "...", status: "processing" }
  ```

- エクスポート処理:
  - ユーザープロフィール、セッション履歴、メッセージなどをJSON形式でエクスポート
  - メールに ZIP ファイルとして送信
  - 処理時間: 24時間以内

- アカウント削除要求エンドポイント:
  ```
  POST /api/users/me/delete-account
  Request Body: { "password": "..." }  // パスワード再確認
  Response: { success: true }
  ```

- 削除処理:
  - ユーザーレコードの論理削除（is_deleted フラグ）
  - 個人情報の匿名化
  - セッション・メッセージのオーナーシップ変更
  - 30日間の復旧可能期間設定

**UI要件**:
- ユーザー設定ページの「データ・プライバシー」セクション
- データエクスポート要求ボタン
- アカウント削除ボタン
- 削除確認ダイアログ（メールアドレス再入力）

---

## 第12章 非機能要件詳細

### 12.1 パフォーマンス最適化

#### 12.1.1 フロントエンド最適化

**要件ID**: PER-F-001

**要件名**: フロントエンド パフォーマンス最適化

**説明**:

- **画像最適化**
  - WebP形式への自動変換
  - レスポンシブ画像（srcset）
  - 遅延ロード（Lazy Loading）

- **コード分割**
  - ルートベースのコード分割
  - 動的インポート（Dynamic Import）
  - バンドルサイズの最小化

- **キャッシング戦略**
  - ブラウザキャッシュ: 1年間（静的アセット）
  - Service Worker: オフライン機能
  - React Query: API応答キャッシング

- **読み込み最適化**
  - 複数のJavaScriptファイルの並列ダウンロード
  - CSS-in-JS（Tailwind）の最小化
  - 不要なライブラリの削除

#### 12.1.2 バックエンド最適化

**要件ID**: PER-B-001

**要件名**: バックエンド パフォーマンス最適化

**説明**:

- **データベース最適化**
  - インデックス設計: 30以上のインデックス
  - クエリ最適化: N+1クエリ問題の回避（Prisma include/select）
  - 接続プーリング: Supabase接続プール設定

- **キャッシング**
  - Redis キャッシング（ユーザー情報、セッション一覧など）
  - ETags実装によるクライアント側キャッシュ
  - Cache-Control ヘッダー設定

- **API最適化**
  - 圧縮（gzip/brotli）
  - ページネーション（大量データ取得時）
  - 不要なフィールド除外（select 句の最適化）

- **スケーリング**
  - Verselサーバーレスの自動スケーリング
  - CDN（Vercel Edge Network）への配置

#### 12.1.3 ネットワーク最適化

**要件ID**: PER-N-001

**要件名**: ネットワーク パフォーマンス最適化

**説明**:

- **リクエスト削減**
  - バッチ API エンドポイント（複数リクエストを1つに統合）
  - WebSocket リアルタイム通信（ポーリング削減）

- **レスポンス時間短縮**
  - エッジネットワークでの処理（Vercel Edge Middleware）
  - 地理的に近いサーバーへのルーティング

### 12.2 可用性・信頼性

#### 12.2.1 エラーハンドリング

**要件ID**: REL-E-001

**要件名**: エラーハンドリング・ログ記録

**説明**:

- **エラー分類**
  - クライアント側エラー（4xx）: ユーザーフレンドリーなエラーメッセージ
  - サーバー側エラー（5xx）: エラーID生成、Sentryに報告、ユーザーには簡潔なメッセージ

- **ログ記録**
  - 全API呼び出しをPino loggerで記録
  - エラースタックトレース記録
  - ユーザー操作ログ（メッセージ送信、セッション参加など）
  - Sentry統合（本番環境のみ）

- **エラー通知**
  - 重大エラー: 管理者へのメール通知
  - リアルタイム: ユーザーへの即座のエラー表示

#### 12.2.2 フェイルオーバー・リカバリ

**要件ID**: REL-F-001

**要件名**: システム障害時のフェイルオーバー

**説明**:

- **データベース障害**
  - Supabaseの自動フェイルオーバー（レプリケーション）
  - 読み込みレプリカへの自動フェイルオーバー

- **API 障害**
  - Verselの複数リージョン配置（自動フェイルオーバー）
  - リトライロジック（エクスポーネンシャルバックオフ）

- **キャッシュ障害**
  - Redis障害時のキャッシュスキップ（データベース直接アクセス）

#### 12.2.3 メンテナンスモード

**要件ID**: REL-M-001

**要件名**: メンテナンスモード

**説明**:

- スケジュール済みメンテナンス時の通知
- メンテナンスモード画面の表示
- ユーザーへの事前通知メール送信
- メンテナンス中のアクセス制限

### 12.3 スケーラビリティ

#### 12.3.1 水平スケーリング対応

**要件ID**: SCA-H-001

**要件名**: 水平スケーリング対応

**説明**:

- **ステートレス設計**
  - サーバーにセッション情報を保持しない（JWT ベース）
  - 複数サーバーインスタンスで同じロジック実行可

- **分散セッション管理**
  - Redis を用いた分散キャッシュ
  - 複数サーバーでのシェア可能

- **データベース最適化**
  - インデックス設計によるクエリ高速化
  - ロックの最小化（楽観的ロック）

#### 12.3.2 負荷分散

**要件ID**: SCA-LB-001

**要件名**: 負荷分散設計

**説明**:

- Vercel による自動負荷分散
- CDN キャッシング による高速配信
- 接続プーリング による効率的なデータベース利用

---

## 第13章 テスト要件

### 13.1 単体テスト

**要件ID**: TEST-U-001

**要件名**: ユニットテスト

**説明**:

- テストフレームワーク: Vitest
- カバレッジ目標: 70%以上
- テスト対象:
  - ユーティリティ関数（lib 配下）
  - コンポーネント（Testing Library）
  - API エンドポイント（ミドルウェア、バリデーション）

- テストケース例:
  - ユーザー登録フォーム検証
  - パスワード強度チェック
  - 信頼度スコア計算
  - 日付フォーマット

### 13.2 統合テスト

**要件ID**: TEST-I-001

**要件名**: 統合テスト

**説明**:

- 全コンポーネント間の統合テスト
- ユーザーフロー テスト（例: ログイン → セッション検索 → 参加）
- API エンドポイント間の依存関係テスト

### 13.3 E2E テスト

**要件ID**: TEST-E-001

**要件名**: エンドツーエンド テスト

**説明**:

- テストフレームワーク: Playwright
- ブラウザ対応: Chromium, Firefox, WebKit
- テストケース:
  - ユーザー登録・ログイン フロー
  - セッション検索・参加 フロー
  - チャット機能
  - レビュー投稿

---

## 第14章 デプロイ・運用要件

### 14.1 デプロイメント

**要件ID**: DEP-001

**要件名**: 本番環境デプロイメント

**説明**:

- **デプロイプラットフォーム**: Vercel
- **デプロイプロセス**:
  - Git push → GitHub
  - GitHub Actions による自動テスト
  - テスト成功後、自動デプロイ
  - ブルーグリーンデプロイメント対応

- **環境設定**:
  - Development環境: ローカル開発環境
  - Staging環境: 本番環境相同環境（テスト用）
  - Production環境: 本番環境（https://sportsmatch-tokyo.vercel.app）

- **設定管理**:
  - 環境変数: Vercelダッシュボードで管理
  - シークレット: サーバーサイドのみ（API キー、データベース認証情報）

### 14.2 監視・ログ

**要件ID**: OPS-M-001

**要件名**: システム監視・ログ管理

**説明**:

- **ログ記録**:
  - Pino logger: アプリケーション内ログ
  - Vercel Analytics: ページパフォーマンス
  - Sentry: エラートラッキング（本番環境）

- **メトリクス監視**:
  - Vercel Analytics Dashboard
  - 応答時間、エラー率の監視
  - ユーザー活動の分析

- **アラート設定**:
  - エラー率が5%超過した場合、管理者にメール通知
  - レスポンス時間が500msを超過した場合、ログ警告

### 14.3 バックアップ・リカバリ

**要件ID**: OPS-B-001

**要件名**: データバックアップ・リカバリ

**説明**:

- **データベースバックアップ**:
  - Supabase による自動日次バックアップ
  - 30日間のバックアップ保持
  - ポイントインタイムリカバリ（PITR）対応

- **復旧計画**:
  - RTO（復旧目標時間）: 30分以内
  - RPO（復旧目標ポイント）: 1時間以内
  - 定期的な復旧テスト（月1回）

---

## 第15章 実装ロードマップ

### フェーズ1: 基盤構築（完了）

- 基本的なユーザー登録・ログイン
- セッション CRUD 機能
- 参加予約基本機能
- ナビゲーション・UI 基盤

### フェーズ2: 完全機能化（完了）

- チャット機能（Supabase Realtime）
- レビュー・評価機能
- 信頼度スコア計算
- セッション検索・フィルタリング
- 管理者ダッシュボード
- 多言語対応（日本語・英語）
- テストスイート（Vitest, Playwright）

### フェーズ3: 高度な機能（計画中）

- ウェイトリスト管理（自動昇格）
- ユーザーブロック機能
- 高度なレコメンデーション（機械学習）
- モバイルアプリ（React Native）
- SNS連携（Twitter, Facebook）
- ビデオ通話機能（Zoom 統合）

### フェーズ4: 商用化（計画中）

- 有料会員プラン
- セッション主催者向けプレミアムツール
- 企業向けAPI
- スポーツアナリティクス

---

## 第16章 用語定義

| 用語 | 定義 |
|------|------|
| **セッション** | ユーザーが企画・開催するスポーツイベント。日時、場所、スポーツ種別、参加定員などを含む。 |
| **プレイヤー** | セッションに参加するユーザー。スポーツを楽しむことが主目的。 |
| **オーガナイザー** | セッションを企画・開催するユーザー。主催者。 |
| **信頼度スコア** | ユーザーの信頼性を数値化したもの。セッション参加状況、評価、検証状態などから算出。 |
| **ウェイトリスト** | セッションが満席の場合、参加希望者が登録するリスト。キャンセル発生時に自動昇格。 |
| **チャットルーム** | セッション参加者同士がリアルタイム会話できるスペース。セッションごとに自動作成。 |
| **レビュー** | セッション終了後、参加者が投稿する5段階評価とコメント。 |
| **ダイレクトメッセージ** | ユーザー間の1対1の非公開メッセージング機能。 |
| **報告** | ユーザーが不適切なセッション・ユーザーを管理者に通報する機能。 |
| **バン** | 違反ユーザーのアカウントを一時的または永続的に無効化する処分。 |
| **モデレーション** | 管理者による報告内容の確認・対応・処分実施。 |
| **多言語対応** | 複数の言語でUIを利用可能な機能。本システムでは日本語と英語。 |
| **リアルタイム** | WebSocket技術により、サーバーとクライアント間でほぼ遅延なしに双方向通信する機能。 |

---

## 第17章 まとめ

本用件定義書は、「SportsMatch Tokyo」の全体像、機能要件、非機能要件、およびセキュリティ・プライバシー要件を網羅している。 このドキュメントに基づき、開発チームはシステムの実装、テスト、デプロイメントを進める。

本システムは、東京においてスポーツ愛好家同士が容易に出会い、共にスポーツを楽しむためのコミュニティプラットフォームとしての位置づけを明確にしている。 セキュリティ、プライバシー、スケーラビリティ、および ユーザー体験を念頭に置いた実装により、長期的に持続可能なプラットフォームの実現を目指す。

---

**文書作成日**: 2024年11月27日
**プロジェクト**: SportsMatch Tokyo
**対象バージョン**: Phase 2 & Beyond
**言語**: 日本語
**区分**: 機密文書（プロジェクト関係者のみ）
